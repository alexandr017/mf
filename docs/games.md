# Мини-игры

## Общая информация

Мини-игры позволяют игрокам зарабатывать рейтинг и улучшать свои навыки. Все игры имеют защиту от накрутки и систему начисления рейтинга.

---

## 1. Тренировка пробития пенальти

### Описание
Игра на точность и удачу. Игрок выбирает угол, куда хочет пробить пенальти, а система случайным образом выбирает, куда падает вратарь.

### Механика
- Игрок выбирает один из трех углов: **В левый угол**, **По центру**, **В правый угол**
- Вратарь случайным образом выбирает направление прыжка
- Если выбор игрока не совпал с выбором вратаря - **ГОЛ!**
- Игра длится минимум 5 секунд (анимация)

### Начисление рейтинга
- За каждый гол: **+0.001** к рейтингу
- Рейтинг начисляется только при успешном попадании

### Защита от накрутки
- Минимальное время выполнения: 5 секунд
- Проверка на слишком частые запросы (не более 1 игры в 5 секунд)
- Сохранение IP-адреса и User Agent

### Статистика
- Всего попыток
- Успешных попаданий
- Процент успеха
- Заработанный рейтинг
- История последних 10 попыток

---

## 2. Прогноз матчей

### Описание
Игра на предсказание исходов реальных матчей. Администратор заполняет матчи вручную, пользователи угадывают исходы.

### Механика
- Пользователю предлагаются матчи на ближайшие 7 дней
- Для каждого матча можно выбрать один из трех исходов:
  - **Победа команды 1**
  - **Ничья**
  - **Победа команды 2**
- Прогноз можно сделать только **1 раз** на матч
- Прогнозы закрываются за 1 час до начала матча (дедлайн)

### Начисление рейтинга
- За каждый правильный прогноз: **+0.001** к рейтингу
- Рейтинг начисляется автоматически после того, как администратор обновит результат матча

### Защита от накрутки
- Один прогноз на матч (уникальный индекс в БД)
- Проверка дедлайна на сервере
- Сохранение IP-адреса и User Agent

### Статистика
- Всего прогнозов
- Угадано правильно
- Процент успеха
- Заработанный рейтинг

### Административная панель
- CRUD для матчей
- Указание команд, даты матча, дедлайна для прогнозов
- Обновление результатов матчей
- Автоматическое начисление рейтинга при обновлении результата

---

## 3. Чеканка (Keepie Uppie)

### Описание
Игра на выносливость и тайминг. Мяч падает сверху, игрок должен вовремя кликать по нему, чтобы подбросить вверх.

### Механика
- Мяч падает сверху с ускорением
- Игрок кликает по мячу, когда он падает (ниже середины экрана)
- Мяч подпрыгивает вверх, игрок получает +1 к счету
- С каждым разом игра становится сложнее:
  - Мяч ускоряется
  - Мяч начинает отклоняться в стороны (горизонтальное движение)
- Игра заканчивается, когда мяч падает вниз

### Начисление рейтинга
- За каждый набитый мяч: **+0.0001** к рейтингу
- Формула: `рейтинг = количество_мячей × 0.0001`

### Защита от накрутки
- Проверка на подозрительно быстрые игры с высоким счетом (>20 мячей за <2 секунд)
- Проверка на слишком частые запросы (не более 1 игры в 5 секунд)
- Сохранение IP-адреса и User Agent

### Статистика
- Лучший результат (максимальное количество набитых мячей)
- Всего игр
- Всего набито мячей
- Заработанный рейтинг
- Таблица лидеров (топ 10 игроков)
- История последних 10 игр

### Связь с футболом
- Прокачивает навык **«Полузащита»**

---

## Технические детали

### Структура таблиц
Все таблицы игр имеют префикс `game_`:
- `game_penalty_training` - результаты тренировки пенальти
- `game_match_predictions` - матчи для прогнозов
- `game_match_predictions_users` - прогнозы пользователей
- `game_keepie_uppie` - результаты чеканки

### Общие правила защиты
1. Минимальное время выполнения игры (для предотвращения автоматизации)
2. Проверка частоты запросов
3. Сохранение IP-адреса и User Agent
4. CSRF-защита

### Начисление рейтинга
- Рейтинг начисляется сразу после завершения игры
- Обновляется в таблице `users` (поле `rating`)
- История начислений сохраняется в таблицах результатов игр

---

## Будущие возможности

- Интеграция с Telegram для игры через бота
- Дополнительные мини-игры
- Сезонные турниры по играм
- Достижения за результаты в играх

